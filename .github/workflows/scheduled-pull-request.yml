name: Scheduled Pull Request
on:
  workflow_dispatch:
  schedule:
    - cron: "*/60 * * * *"
    
jobs:
  scheduled-pull-request:
    runs-on: common-8gb
    steps:
    - name: üêô Checkout code
      uses: actions/checkout@v3
    - name: Create Pull Request
      uses: actions/github-script@v6
      with:
        script: |
          const { repo, owner } = context.repo;

          const pulls = await github.rest.pulls.list({
              owner: owner,
              repo: repo,
              head: context.ref,
              base: 'main',
              state: 'open',
          });

          if (pulls.data.length < 1) {
            await github.rest.pulls.create({
              title: '[CI] Merge beta into main',
              owner: owner,
              repo: repo,
              head: 'stage',
              base: 'main',
              body: [
                'This PR is auto-generated by',
                '[actions/github-script](https://github.com/actions/github-script)',
              ].join('\n'),
            });
          } else {
            const existingPR = pulls.data[0];
            await github.rest.pulls.update({
              title: 'Okay new title guys',
              owner: owner,
              repo: repo,
              pull_number: existingPR.number,
              body: [
                existingPR.body,
                `Updated by Job ${context.job}`,
              ].join('\n'),
            });
          }